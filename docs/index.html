<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>营销海报生成工作流</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <div class="header-content">
        <div>
          <h1>营销海报生成工作流</h1>
          <p>依次完成素材输入、海报生成与邮件发送，打造现代简洁的厨电宣传海报。</p>
        </div>

        <label class="api-config">
          <span>后端 API 地址</span>
          <input
            type="url"
            id="api-base"
            placeholder="https://your-render-service.onrender.com"
          />
        </label>
      </div>
    </header>

    <main>
      <!-- 环节 1：素材输入 + 版式预览 -->
      <section id="input-section" class="card">
        <h2>环节 1 · 素材输入与版式预览</h2>

        <form id="poster-form">
          <div class="layout-fields">
            <!-- 顶部横条 -->
            <fieldset class="fieldset">
              <legend>顶部横条</legend>
              <div class="grid">
                <label class="field file-field">
                  <span>品牌 Logo 上传</span>
                  <input type="file" name="brand_logo" accept="image/*" />
                </label>
                <label class="field">
                  <span>品牌名称 / 代理名</span>
                  <input type="text" name="brand_name" required />
                </label>
              </div>
            </fieldset>

            <!-- 图像素材 -->
            <fieldset class="fieldset">
              <legend>图像素材</legend>
              <div class="grid">
                <label class="field file-field">
                  <span>应用场景图上传</span>
                  <input type="file" name="scenario_asset" accept="image/*" />
                </label>
                <label class="field">
                  <span>应用场景描述（用于提示词）</span>
                  <textarea name="scenario_image" rows="3" required></textarea>
                </label>

                <label class="field file-field">
                  <span>产品 45° 渲染图上传</span>
                  <input type="file" name="product_asset" accept="image/*" />
                </label>
                <label class="field">
                  <span>主产品名称</span>
                  <input type="text" name="product_name" required />
                </label>

                <label class="field file-field">
                  <span>底部产品小图（3-4 张，支持多选）</span>
                  <input type="file" name="gallery_assets" accept="image/*" multiple />
                </label>
                <label class="field">
                  <span>三视图 / 系列说明</span>
                  <textarea name="series_description" rows="2" required></textarea>
                </label>
              </div>
            </fieldset>

            <!-- 文案字段（不含邮箱） -->
            <fieldset class="fieldset">
              <legend>文案字段</legend>
              <div class="grid">
                <label class="field">
                  <span>标题文案</span>
                  <input type="text" name="title" required />
                </label>
                <label class="field">
                  <span>副标题文案</span>
                  <input type="text" name="subtitle" required />
                </label>
              </div>
            </fieldset>

            <!-- 功能点 -->
            <fieldset class="features">
              <legend>功能点（填写 3-4 条）</legend>
              <div class="feature-item">
                <input type="text" name="features" required />
              </div>
              <div class="feature-item">
                <input type="text" name="features" required />
              </div>
              <div class="feature-item">
                <input type="text" name="features" required />
              </div>
              <div class="feature-item">
                <input type="text" name="features" placeholder="可选" />
              </div>
            </fieldset>
          </div>
        </form>

        <!-- 版式预览按钮 -->
        <button id="build-preview" class="secondary" type="button">构建版式预览</button>

        <!-- 版式预览容器：初始隐藏，由 JS 决定展示 -->
        <div class="preview hidden" id="preview-container">
          <h3>版式预览</h3>
          <div id="layout-preview" class="poster-preview">
            <div class="poster-header">
              <div class="poster-logo">
                <img id="preview-brand-logo" alt="品牌 Logo 预览" />
              </div>
              <div class="poster-brand" id="preview-brand-name"></div>
            </div>

            <div class="poster-body">
              <div class="poster-left">
                <img id="preview-scenario-image" alt="应用场景预览" />
              </div>

              <!-- 右侧主视觉（主产品 + 功能点标注） -->
              <div class="poster-right">
                <div class="poster-product-wrapper">
                  <img id="preview-product-image" alt="产品渲染图预览" />
                  <!-- 功能点紧跟主产品，位于底部小图之前 -->
                  <ul id="preview-feature-list"></ul>
                </div>
              </div>
            </div>

            <div class="poster-title" id="preview-title"></div>
            <!-- 底部小图在功能点之后 -->
            <div class="poster-gallery" id="preview-gallery"></div>
            <div class="poster-series" id="preview-series-description"></div>
            <div class="poster-subtitle" id="preview-subtitle"></div>
          </div>

          <details class="layout-structure">
            <summary>查看版式结构说明</summary>
            <pre id="layout-structure-text"></pre>
          </details>
        </div>
      </section>

      <!-- 环节 2：生成海报 -->
      <section id="generation-section" class="card">
        <h2>环节 2 · 调用后端生成海报</h2>
        <p class="hint">
          点击下方按钮后，系统会向 FastAPI 服务提交素材，后端会调用 AI 生成海报（并返回预览图），同时输出提示词与营销邮件草稿。
        </p>
        <button id="generate-poster" class="primary">生成海报与文案</button>

        <div id="poster-output" class="hidden">
          <!-- AI 生成预览（含转圈提示） -->
          <div class="output-group" id="ai-preview">
            <h3>AI 生成预览</h3>
            <div class="ai-preview-canvas">
              <div class="spinner" id="ai-spinner" aria-hidden="true"></div>
              <p id="ai-preview-message">正在调用 AI 生成海报，请稍候…</p>
            </div>
          </div>

          <!-- 海报图片 -->
          <div class="output-group hidden" id="poster-visual">
            <h3>海报预览</h3>
            <img id="poster-image" alt="海报预览" />
          </div>

          <!-- 提示词 -->
          <div class="output-group hidden" id="prompt-group">
            <h3>AI 提示词</h3>
            <textarea id="glibatree-prompt" rows="10" readonly></textarea>
          </div>

          <!-- 邮件草稿 -->
          <div class="output-group hidden" id="email-group">
            <h3>营销邮件草稿</h3>
            <textarea id="generated-email" rows="10"></textarea>
          </div>
        </div>

        <!-- 再次生成 -->
        <button id="regenerate-poster" class="secondary hidden" type="button">
          再次生成海报
        </button>
      </section>

      <!-- 环节 3：发送邮件 -->
      <section id="email-section" class="card">
        <h2>环节 3 · 邮件发送</h2>
        <div class="grid">
          <label class="field">
            <span>收件邮箱</span>
            <input type="email" id="email-recipient" required />
          </label>
          <label class="field">
            <span>邮件主题</span>
            <input type="text" id="email-subject" required />
          </label>
        </div>
        <label class="field">
          <span>邮件正文</span>
          <textarea id="email-body" rows="10" required></textarea>
        </label>
        <button id="send-email" class="primary">发送营销邮件</button>
        <p id="status" role="status"></p>
      </section>
    </main>

    <footer>
      <small>前端托管于 GitHub Pages，后端由 Render 提供服务。</small>
    </footer>

    <script src="app.js" type="module"></script>
  </body>
</html>
